import { themes } from 'mdx-deck'
export const theme = themes.swiss

<Head>
    <title>Stale closures in-depth ğŸ¤«</title>
</Head>

# ReactKHI meetup 2020 ğŸ™

## How to deal with stale closures in-depth? ğŸ§
---

### Table of contents ğŸ“‰

0. Resources ğŸ“‘
1. Introduction ğŸ™†â€
2. Expectations ğŸ‘€
3. Understand the Problem ğŸ§Ÿâ€
4. Pre-requisites ğŸš§
5. Solutions ğŸ˜‹
6. Recap ğŸ¤ 
7. Takeaways ğŸ’¸

---
# Resources ğŸ“‘

- You can find the slides here â¡ï¸
  **[bit.ly/stale-closures](http://bit.ly/stale-closures)**

- Understanding the Problem ğŸ§Ÿâ€:
    - Source codes ğŸ’°: [Problem 1][stale-closures-1], [Problem 2][stale-closures-2]
- Scope ğŸ‘€ & Closure ğŸ˜ˆ:
    - Source codes ğŸ’°: [Scope examples][scope-example-1], [Closure examples][closure-example]
- useState ğŸ“¦ & useRef ğŸ¤ Hooks:
    - Source codes ğŸ’°: [useState example][use-state-hook], [useRef example][use-ref-hook]
- Solutions ğŸ˜‹:
    - Source codes ğŸ’°: [Solution 1][stale-closures-solution-1], [Solution 2][stale-closures-solution-2]

---

# Introduction ğŸ™†â€

---

# Introduction ğŸ™†â€

This is Ahmad ğŸ‘¨â€ğŸ’», a full-stack JS engineer ğŸ› . You can also call me a **_JavaScriptuer_** ğŸ¥´.

---

# Introduction ğŸ™†â€

This is Ahmad ğŸ‘¨â€ğŸ’», a full-stack JS engineer ğŸ› . You can also call me a **_JavaScriptuer_** ğŸ¥´.

- ğŸ­ ~7 years (since 2013)

---

# Introduction ğŸ™†â€

This is Ahmad ğŸ‘¨â€ğŸ’», a full-stack JS engineer ğŸ› . You can also call me a **_JavaScriptuer_** ğŸ¥´.

- ğŸ­ ~7 years (since 2013)
- ğŸ’¼ [@blacksms][black-sms]

---

# Introduction ğŸ™†â€

This is Ahmad ğŸ‘¨â€ğŸ’», a full-stack JS engineer ğŸ› . You can also call me a **_JavaScriptuer_** ğŸ¥´.

- ğŸ­ ~7 years (since 2013)
- ğŸ’¼ [@blacksms][black-sms]
- ğŸ“š ICS (credit goes to ğŸ˜·)

---

# Introduction ğŸ™†â€

This is Ahmad ğŸ‘¨â€ğŸ’», a full-stack JS engineer ğŸ› . You can also call me a **_JavaScriptuer_** ğŸ¥´.

- ğŸ­ ~7 years (since 2013)
- ğŸ’¼ [@blacksms][black-sms]
- ğŸ“š ICS (credit goes to ğŸ˜·)
- ğŸ  Okara, Punjab

---

# Introduction ğŸ™†â€

This is Ahmad ğŸ‘¨â€ğŸ’», a full-stack JS engineer ğŸ› . You can also call me a **_JavaScriptuer_** ğŸ¥´.

- ğŸ­ ~7 years (since 2013)
- ğŸ’¼ [@blacksms][black-sms]
- ğŸ“š ICS (credit goes to ğŸ˜·)
- ğŸ  Okara, Punjab
- ğŸŒ @iamfotx ([Github][github], [Twitter][twitter], [Linked In][linked-in], [Facebook][facebook], & [Email me][email-me])

---

# Introduction ğŸ™†â€

This is Ahmad ğŸ‘¨â€ğŸ’», a full-stack JS engineer ğŸ› . You can also call me a **_JavaScriptuer_** ğŸ¥´.

- ğŸ­ ~7 years (since 2013)
- ğŸ’¼ [@blacksms][black-sms]
- ğŸ“š ICS (credit goes to ğŸ˜·)
- ğŸ  Okara, Punjab
- ğŸŒ @iamfotx ([Github][github], [Twitter][twitter], [Linked In][linked-in], [Facebook][facebook], & [Email me][email-me])
- â¤ï¸ Stackoverflow & Emojis

---

# Expectations ğŸ‘€

---

# Expectations ğŸ‘€

Let's set some expectations, so you know what to expect from this talk ğŸ¤¨.

---

# Expectations ğŸ‘€

Let's set some expectations, so you know what to expect from this talk ğŸ¤¨.

### This talk is not about ğŸš«


---

# Expectations ğŸ‘€

Let's set some expectations, so you know what to expect from this talk ğŸ¤¨.

### This talk is not about ğŸš«

- Class components at all ğŸ˜¬


---

# Expectations ğŸ‘€

Let's set some expectations, so you know what to expect from this talk ğŸ¤¨.

### This talk is not about ğŸš«

- Class components at all ğŸ˜¬
- Why stale closures don't exist in class components? ğŸ¤ (if you want to deep dive, read [this][functional-vs-class-components])

---

# Expectations ğŸ‘€

Let's set some expectations, so you know what to expect from this talk ğŸ¤¨.

### This talk is not about ğŸš«

- Class components at all ğŸ˜¬
- Why stale closures don't exist in class components? ğŸ¤ (if you want to deep dive, read [this][functional-vs-class-components])
- Under the hood implementation of hooks

---

# Expectations ğŸ‘€

Let's set some expectations, so you know what to expect from this talk ğŸ¤¨.

### This talk is not about ğŸš«

- Class components at all ğŸ˜¬
- Why stale closures don't exist in class components? ğŸ¤ (if you want to deep dive, read [this][functional-vs-class-components])
- Under the hood implementation of hooks

### This talk is all about âœ…


---

# Expectations ğŸ‘€

Let's set some expectations, so you know what to expect from this talk ğŸ¤¨.

### This talk is not about ğŸš«

- Class components at all ğŸ˜¬
- Why stale closures don't exist in class components? ğŸ¤ (if you want to deep dive, read [this][functional-vs-class-components])
- Under the hood implementation of hooks

### This talk is all about âœ…

- Understanding the Problem ğŸ§Ÿâ€


---

# Expectations ğŸ‘€

Let's set some expectations, so you know what to expect from this talk ğŸ¤¨.

### This talk is not about ğŸš«

- Class components at all ğŸ˜¬
- Why stale closures don't exist in class components? ğŸ¤ (if you want to deep dive, read [this][functional-vs-class-components])
- Under the hood implementation of hooks

### This talk is all about âœ…

- Understanding the Problem ğŸ§Ÿâ€
- Pre-requisites ğŸš§


---

# Expectations ğŸ‘€

Let's set some expectations, so you know what to expect from this talk ğŸ¤¨.

### This talk is not about ğŸš«

- Class components at all ğŸ˜¬
- Why stale closures don't exist in class components? ğŸ¤ (if you want to deep dive, read [this][functional-vs-class-components])
- Under the hood implementation of hooks

### This talk is all about âœ…

- Understanding the Problem ğŸ§Ÿâ€
- Pre-requisites ğŸš§
    - Scope ğŸ‘ & Closure ğŸ˜ˆ


---

# Expectations ğŸ‘€

Let's set some expectations, so you know what to expect from this talk ğŸ¤¨.

### This talk is not about ğŸš«

- Class components at all ğŸ˜¬
- Why stale closures don't exist in class components? ğŸ¤ (if you want to deep dive, read [this][functional-vs-class-components])
- Under the hood implementation of hooks

### This talk is all about âœ…

- Understanding the Problem ğŸ§Ÿâ€
- Pre-requisites ğŸš§
    - Scope ğŸ‘ & Closure ğŸ˜ˆ
    - useState ğŸ“¦ & useRef ğŸ¤ Hooks

---

# Expectations ğŸ‘€

Let's set some expectations, so you know what to expect from this talk ğŸ¤¨.

### This talk is not about ğŸš«

- Class components at all ğŸ˜¬
- Why stale closures don't exist in class components? ğŸ¤ (if you want to deep dive, read [this][functional-vs-class-components])
- Under the hood implementation of hooks

### This talk is all about âœ…

- Understanding the Problem ğŸ§Ÿâ€
- Pre-requisites ğŸš§
    - Scope ğŸ‘ & Closure ğŸ˜ˆ
    - useState ğŸ“¦ & useRef ğŸ¤ Hooks
- Solutions ğŸ˜‹

---

# Understand the Problem ğŸ§Ÿâ€


---

# Understand the Problem ğŸ§Ÿâ€

Source codes ğŸ’°: [Problem 1][stale-closures-1], [Problem 2][stale-closures-2]

---

# Understand the Problem ğŸ§Ÿâ€

Source codes ğŸ’°: [Problem 1][stale-closures-1], [Problem 2][stale-closures-2]

### What does the term "stale closure" mean?

---
# Understand the Problem ğŸ§Ÿâ€

Source codes ğŸ’°: [Problem 1][stale-closures-1], [Problem 2][stale-closures-2]

### What does the term "stale closure" mean?


- Stale means **outdated**.


---
# Understand the Problem ğŸ§Ÿâ€

Source codes ğŸ’°: [Problem 1][stale-closures-1], [Problem 2][stale-closures-2]

### What does the term "stale closure" mean?


- Stale means **outdated**.
- So, stale closure is when a closure gets outdated ğŸ¤§.

---
# Pre-requisites ğŸš§


---
# Pre-requisites ğŸš§

Lets deep-dive into all of these pieces individually.


---
# Pre-requisites ğŸš§

Lets deep-dive into all of these pieces individually.

- Scope ğŸ‘

---
# Pre-requisites ğŸš§

Lets deep-dive into all of these pieces individually.

- Scope ğŸ‘
- Closure ğŸ˜ˆ

---
# Pre-requisites ğŸš§

Lets deep-dive into all of these pieces individually.

- Scope ğŸ‘
- Closure ğŸ˜ˆ
- useState Hook ğŸ“¦

---
# Pre-requisites ğŸš§

Lets deep-dive into all of these pieces individually.

- Scope ğŸ‘
- Closure ğŸ˜ˆ
- useState Hook ğŸ“¦
- useRef Hook ğŸ¤

---
# Scope ğŸ‘

---
# Scope ğŸ‘

Source codes ğŸ’°: [Example 1][scope-example-1]

---
# Scope ğŸ‘

Source codes ğŸ’°: [Example 1][scope-example-1]

### What does the term "scope" mean?

---
# Scope ğŸ‘

Source codes ğŸ’°: [Example 1][scope-example-1]

### What does the term "scope" mean?

- Scope is mechanism to look for things (things ğŸ¤¨).

---
# Scope ğŸ‘

Source codes ğŸ’°: [Example 1][scope-example-1]

### What does the term "scope" mean?

- Scope is mechanism to look for things (things ğŸ¤¨).
    - By things, I mean the identifiers.

---
# Scope ğŸ‘

Source codes ğŸ’°: [Example 1][scope-example-1]

### What does the term "scope" mean?

- Scope is mechanism to look for things (things ğŸ¤¨).
    - By things, I mean the identifiers.

### Where does it look for things?

---
# Scope ğŸ‘

Source codes ğŸ’°: [Example 1][scope-example-1]

### What does the term "scope" mean?

- Scope is mechanism to look for things (things ğŸ¤¨).
    - By things, I mean the identifiers.

### Where does it look for things?

- It looks for things in variable environments, V.E (in simple words, local memory).

---
# Scope ğŸ‘

Source codes ğŸ’°: [Example 1][scope-example-1]

### What does the term "scope" mean?

- Scope is mechanism to look for things (things ğŸ¤¨).
    - By things, I mean the identifiers.

### Where does it look for things?

- It looks for things in variable environments, V.E (in simple words, local memory).
- These are the ~~two~~ ways, how a V.E gets created (fns, & blocks).

---
# Scope ğŸ‘

Source codes ğŸ’°: [Example 1][scope-example-1]

### What does the term "scope" mean?

- Scope is mechanism to look for things (things ğŸ¤¨).
    - By things, I mean the identifiers.

### Where does it look for things?

- It looks for things in variable environments, V.E (in simple words, local memory).
- These are the ~~two~~ ways, how a V.E gets created (fns, & blocks).
    - With that being said, it means a V.E is being created when:

---
# Scope ğŸ‘

Source codes ğŸ’°: [Example 1][scope-example-1]

### What does the term "scope" mean?

- Scope is mechanism to look for things (things ğŸ¤¨).
    - By things, I mean the identifiers.

### Where does it look for things?

- It looks for things in variable environments, V.E (in simple words, local memory).
- These are the ~~two~~ ways, how a V.E gets created (fns, & blocks).
    - With that being said, it means a V.E is being created when:
        - A function gets declared (We'll stick with fns for now).

---
# Scope ğŸ‘

Source codes ğŸ’°: [Example 1][scope-example-1]

### What does the term "scope" mean?

- Scope is mechanism to look for things (things ğŸ¤¨).
    - By things, I mean the identifiers.

### Where does it look for things?

- It looks for things in variable environments, V.E (in simple words, local memory).
- These are the ~~two~~ ways, how a V.E gets created (fns, & blocks).
    - With that being said, it means a V.E is being created when:
        - A function gets declared (We'll stick with fns for now).
        - A block gets created.
---
# Scope ğŸ‘

Source codes ğŸ’°: [Example 1][scope-example-1]

Resources ğŸ“‘: [Image 1][scope-image-1], [Image 2][scope-image-2]

### What happens, when a function gets defined & executed?


---
# Scope ğŸ‘

Source codes ğŸ’°: [Example 1][scope-example-1]

Resources ğŸ“‘: [Image 1][scope-image-1], [Image 2][scope-image-2]

### What happens, when a function gets defined & executed?

- When you define a fn, it comes with a V.E, where it stores all the variables during execution.

---
# Scope ğŸ‘

Source codes ğŸ’°: [Example 1][scope-example-1]

Resources ğŸ“‘: [Image 1][scope-image-1], [Image 2][scope-image-2]

### What happens, when a function gets defined & executed?

- When you define a fn, it comes with a V.E, where it stores all the variables during execution.
    - It automatically garbage-collects all those variables after execution.

---
# Scope ğŸ‘

Source codes ğŸ’°: [Example 1][scope-example-1]

Resources ğŸ“‘: [Image 1][scope-image-1], [Image 2][scope-image-2]

### What happens, when a function gets defined & executed?

- When you define a fn, it comes with a V.E, where it stores all the variables during execution.
    - It automatically garbage-collects all those variables after execution.

<img src="http://localhost:8081/fn-execution.jpeg" style={{ height: 450}} />

---
# Scope ğŸ‘

Source codes ğŸ’°: [Example 2][scope-example-2]

### okay, okay! What does the term "lexical" mean in lexical scoping then ğŸ¥º?

---
# Scope ğŸ‘

Source codes ğŸ’°: [Example 2][scope-example-2]

### okay, okay! What does the term "lexical" mean in lexical scoping then ğŸ¥º?

- We know scope is just a mechanism to look for things, with that in mind:

---
# Scope ğŸ‘

Source codes ğŸ’°: [Example 2][scope-example-2]

### okay, okay! What does the term "lexical" mean in lexical scoping then ğŸ¥º?

- We know scope is just a mechanism to look for things, with that in mind:
    - lexical scoping is just an extended version of that mechanism to deal with nested V.Es

---
# Closure ğŸ˜ˆ

---
# Closure ğŸ˜ˆ

Source codes ğŸ’°: [Examples][closure-example]

---
# Closure ğŸ˜ˆ

Source codes ğŸ’°: [Examples][closure-example]

Okay so now, we understand lexical scoping. Lets deep-dive into closure.

---
# Closure ğŸ˜ˆ

Source codes ğŸ’°: [Examples][closure-example]

Okay so now, we understand lexical scoping. Lets deep-dive into closure.

### What is closure ğŸ˜ˆ?

---
# Closure ğŸ˜ˆ

Source codes ğŸ’°: [Examples][closure-example]

Okay so now, we understand lexical scoping. Lets deep-dive into closure.

### What is closure ğŸ˜ˆ?

- Closure is when a function somehow **remembers its outer V.E** during execution, even if it was called from a totally different place from where it was born ğŸ¤¯.

---
# Closure ğŸ˜ˆ

Source codes ğŸ’°: [Examples][closure-example]

Okay so now, we understand lexical scoping. Lets deep-dive into closure.

### What is closure ğŸ˜ˆ?

- Closure is when a function somehow **remembers its outer V.E** during execution, even if it was called from a totally different place from where it was born ğŸ¤¯.
    - By remember I mean, it ~~captures~~ creates a live link.

---
# Closure ğŸ˜ˆ

Source codes ğŸ’°: [Examples][closure-example]

Okay so now, we understand lexical scoping. Lets deep-dive into closure.

### What is closure ğŸ˜ˆ?

- Closure is when a function somehow **remembers its outer V.E** during execution, even if it was called from a totally different place from where it was born ğŸ¤¯.
    - By remember I mean, it ~~captures~~ creates a live link.
- In simple words, it extends its own V.E.

---
# useState Hook ğŸ“¦

---
# useState Hook ğŸ“¦

Source codes ğŸ’°: [Example][use-state-hook]

---
# useState Hook ğŸ“¦

Source codes ğŸ’°: [Example][use-state-hook]

### How do you define useState hook?

---
# useState Hook ğŸ“¦

Source codes ğŸ’°: [Example][use-state-hook]

### How do you define useState hook?
- ~~useState hook lets you add state to your functional components~~

---
# useState Hook ğŸ“¦

Source codes ğŸ’°: [Example][use-state-hook]

### How do you define useState hook?
- ~~useState hook lets you add state to your functional components~~
- I.M.O, useState is an API that lets you do the following in functional components:

---
# useState Hook ğŸ“¦

Source codes ğŸ’°: [Example][use-state-hook]

### How do you define useState hook?
- ~~useState hook lets you add state to your functional components~~
- I.M.O, useState is an API that lets you do the following in functional components:
    - Persist a value across each render.

---
# useState Hook ğŸ“¦

Source codes ğŸ’°: [Example][use-state-hook]

### How do you define useState hook?
- ~~useState hook lets you add state to your functional components~~
- I.M.O, useState is an API that lets you do the following in functional components:
    - Persist a value across each render.
    - Triggers re-render when you update that persisted value.
---
# useRef Hook ğŸ¤

---
# useRef Hook ğŸ¤

Source codes ğŸ’°: [Example][use-ref-hook]

---
# useRef Hook ğŸ¤

Source codes ğŸ’°: [Example][use-ref-hook]

### How do you define useRef hook?

---
# useRef Hook ğŸ¤

Source codes ğŸ’°: [Example][use-ref-hook]

### How do you define useRef hook?

- useRef hook is an API somewhat similar to useState that does the followings:


---
# useRef Hook ğŸ¤

Source codes ğŸ’°: [Example][use-ref-hook]

### How do you define useRef hook?

- useRef hook is an API somewhat similar to useState that does the followings:
    - It returns a single mutable object that persists across each render.

---
# useRef Hook ğŸ¤

Source codes ğŸ’°: [Example][use-ref-hook]

### How do you define useRef hook?

- useRef hook is an API somewhat similar to useState that does the followings:
    - It returns a single mutable object that persists across each render.
    - Unlike useState, it doesn't re-render on mutating the persisted object.

---
# Solutions ğŸ˜‹

---
# Solutions ğŸ˜‹

Source codes ğŸ’°: [Solution 1][stale-closures-solution-1], [Solution 2][stale-closures-solution-2]


---
# Solutions ğŸ˜‹

Source codes ğŸ’°: [Solution 1][stale-closures-solution-1], [Solution 2][stale-closures-solution-2]

<img src="http://localhost:8081/playing-computer.gif" style={{ height: 500}}/>

---
# Recap ğŸ¤ 

---
# Recap ğŸ¤ 

### What's the right tool when you need a persistent value across each render to show UI changes?

---
# Recap ğŸ¤ 

### What's the right tool when you need a persistent value across each render to show UI changes?

<img src="http://localhost:8081/use-state.png" style={{ height: 500}}/>

---
# Recap ğŸ¤ 

### What's the right tool when you need a persistent value across each render regardless of UI changes?


---
# Recap ğŸ¤ 

### What's the right tool when you need a persistent value across each render regardless of UI changes?

<img src="http://localhost:8081/use-ref.png" style={{ height: 500}}/>

---
# Takeaways ğŸ’¸

---
# Takeaways ğŸ’¸

- Ask *why* not only when it didn't work but also when it worked.

---
# Takeaways ğŸ’¸

- Ask *why* not only when it didn't work but also when it worked.
- Treat your juniors well, and help them as much as possible.

---
# Takeaways ğŸ’¸

- Ask *why* not only when it didn't work but also when it worked.
- Treat your juniors well, and help them as much as possible.

### for juniors

---
# Takeaways ğŸ’¸

- Ask *why* not only when it didn't work but also when it worked.
- Treat your juniors well, and help them as much as possible.

### for juniors

- When reaching out to a Sr. for help:

---
# Takeaways ğŸ’¸

- Ask *why* not only when it didn't work but also when it worked.
- Treat your juniors well, and help them as much as possible.

### for juniors

- When reaching out to a Sr. for help:
    - Tell them the problem & the end product you're looking for.

---
# Takeaways ğŸ’¸

- Ask *why* not only when it didn't work but also when it worked.
- Treat your juniors well, and help them as much as possible.

### for juniors

- When reaching out to a Sr. for help:
    - Tell them the problem & the end product you're looking for.
    - Also tell them about X, Y, & Z solutions you've tried so far.

---
# Takeaways ğŸ’¸

- Ask *why* not only when it didn't work but also when it worked.
- Treat your juniors well, and help them as much as possible.

### for juniors

- When reaching out to a Sr. for help:
    - Tell them the problem & the end product you're looking for.
    - Also tell them about X, Y, & Z solutions you've tried so far.

### Thank you all ğŸ™‚

[comment]: # (Stale closures in action)

[stale-closures-1]: https://codesandbox.io/s/stale-closures-1-xut3g
[stale-closures-2]: https://codesandbox.io/s/stale-closures-2-culy8

[comment]: # (Stale closures solution)

[stale-closures-solution-1]: https://codesandbox.io/s/stale-closures-solution-1-1dpeo
[stale-closures-solution-2]: https://codesandbox.io/s/stale-closures-solution-2-plsrb

[comment]: # (Personal Info)

[github]: https://www.github.com/iamfotx
[twitter]: https://www.twitter.com/iamfotx
[linked-in]: https://www.linkedin.com/in/iamfotx
[facebook]: https://www.facebook.com/iamfotx
[email-me]: mailto://iamfotx@gmail.com
[black-sms]: https://www.linkedin.com/company/black-sms


[comment]: # (Scope)

[scope-example-1]: https://codesandbox.io/s/scope-examples-fmw9z?file=/src/example-0.js
[scope-example-2]: https://codesandbox.io/s/scope-examples-fmw9z?file=/src/example-1.js

[scope-image-1]: https://drive.google.com/file/d/1K30am-JVcNtgNrsLoM-Ze_3_Ad4ykgCh/view?usp=sharing
[scope-image-2]: https://drive.google.com/file/d/1IfXGmO5_wv0RPVO36mCiO8SS3Bap752V/view?usp=sharing

[comment]: # (Closure)

[closure-example]: https://codesandbox.io/s/closure-examples-jfn6h?file=/src/example-0.js

[comment]: # (useState hook)

[use-state-hook]: https://codesandbox.io/s/use-state-hook-x31gu?file=/src/App.js

[comment]: # (useRef hook)

[use-ref-hook]: https://codesandbox.io/s/use-ref-hook-bjgn5?file=/src/App.js

[comment]: # (Others)

[functional-vs-class-components]: https://overreacted.io/how-are-function-components-different-from-classes/

