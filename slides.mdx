import {themes} from 'mdx-deck'
export const theme = themes.swiss

<Head>
  <title>Stale closures in-depth ğŸ¤«</title>
</Head>

# ReactKHI meetup 2020 ğŸ™

## How to deal with stale closures in-depth? ğŸ§

---

### Table of contents ğŸ“‰

0. Resources ğŸ“‘
1. Introduction ğŸ™†â€
2. Expectations ğŸ‘€
3. Pre-requisites ğŸš§
4. Understand the Problem ğŸ§Ÿâ€
5. Solutions ğŸ˜‹
6. Recap ğŸ¤ 
7. Takeaways ğŸ’¸

---

# Resources ğŸ“‘

- Scope ğŸ‘€ & Closure ğŸ˜ˆ:
  - Source codes ğŸ’°: [Scope examples][scope-example-1], [Closure
    examples][closure-example]
- useState ğŸ“¦ & useRef ğŸ¤ Hooks:
  - Source codes ğŸ’°: [useState example][use-state-hook], [useRef
    example][use-ref-hook]
- Understanding the Problem ğŸ§Ÿâ€:
  - Source codes ğŸ’°: [Problem 1][stale-closures-1], [Problem
    2][stale-closures-2]
- Solutions ğŸ˜‹:
  - Source codes ğŸ’°: [Solution 1][stale-closures-solution-1], [Solution
    2][stale-closures-solution-2]

---

# Introduction ğŸ™†â€

This is Ahmad ğŸ‘¨â€ğŸ’», a full-stack JS engineer ğŸ› . You can also call me a
**_JavaScriptuer_** ğŸ¥´. I'm on the internet as **@iamfotx**.

- ğŸ­ ~7 years (since 2013)
- ğŸ’¼ [@blacksms][black-sms]
- ğŸ“š ICS (credit goes to ğŸ˜·)
- ğŸ  Okara, Punjab
- â¤ï¸ Stackoverflow & Emojis

---

# Expectations ğŸ‘€

---

# Expectations ğŸ‘€

Let's set some expectations, so you know what to expect from this talk ğŸ¤¨.

---

# Expectations ğŸ‘€

Let's set some expectations, so you know what to expect from this talk ğŸ¤¨.

### This talk is not about ğŸš«

---

# Expectations ğŸ‘€

Let's set some expectations, so you know what to expect from this talk ğŸ¤¨.

### This talk is not about ğŸš«

- Class components at all ğŸ˜¬
  - Why stale closures don't exist in class components? ğŸ¤ (if you want to deep
    dive, read [this][functional-vs-class-components])

---

# Expectations ğŸ‘€

Let's set some expectations, so you know what to expect from this talk ğŸ¤¨.

### This talk is not about ğŸš«

- Class components at all ğŸ˜¬
  - Why stale closures don't exist in class components? ğŸ¤ (if you want to deep
    dive, read [this][functional-vs-class-components])
- Under the hood implementation of hooks

---

# Expectations ğŸ‘€

Let's set some expectations, so you know what to expect from this talk ğŸ¤¨.

### This talk is not about ğŸš«

- Class components at all ğŸ˜¬
  - Why stale closures don't exist in class components? ğŸ¤ (if you want to deep
    dive, read [this][functional-vs-class-components])
- Under the hood implementation of hooks

### This talk is all about âœ…

---

# Expectations ğŸ‘€

Let's set some expectations, so you know what to expect from this talk ğŸ¤¨.

### This talk is not about ğŸš«

- Class components at all ğŸ˜¬
  - Why stale closures don't exist in class components? ğŸ¤ (if you want to deep
    dive, read [this][functional-vs-class-components])
- Under the hood implementation of hooks

### This talk is all about âœ…

- Pre-requisites ğŸš§

---

# Expectations ğŸ‘€

Let's set some expectations, so you know what to expect from this talk ğŸ¤¨.

### This talk is not about ğŸš«

- Class components at all ğŸ˜¬
  - Why stale closures don't exist in class components? ğŸ¤ (if you want to deep
    dive, read [this][functional-vs-class-components])
- Under the hood implementation of hooks

### This talk is all about âœ…

- Pre-requisites ğŸš§
  - Scope ğŸ‘ & Closure ğŸ˜ˆ

---

# Expectations ğŸ‘€

Let's set some expectations, so you know what to expect from this talk ğŸ¤¨.

### This talk is not about ğŸš«

- Class components at all ğŸ˜¬
  - Why stale closures don't exist in class components? ğŸ¤ (if you want to deep
    dive, read [this][functional-vs-class-components])
- Under the hood implementation of hooks

### This talk is all about âœ…

- Pre-requisites ğŸš§
  - Scope ğŸ‘ & Closure ğŸ˜ˆ
  - useState ğŸ“¦ & useRef ğŸ¤ Hooks

---

# Expectations ğŸ‘€

Let's set some expectations, so you know what to expect from this talk ğŸ¤¨.

### This talk is not about ğŸš«

- Class components at all ğŸ˜¬
  - Why stale closures don't exist in class components? ğŸ¤ (if you want to deep
    dive, read [this][functional-vs-class-components])
- Under the hood implementation of hooks

### This talk is all about âœ…

- Pre-requisites ğŸš§
  - Scope ğŸ‘ & Closure ğŸ˜ˆ
  - useState ğŸ“¦ & useRef ğŸ¤ Hooks
- Understanding the Problem ğŸ§Ÿâ€

---

# Expectations ğŸ‘€

Let's set some expectations, so you know what to expect from this talk ğŸ¤¨.

### This talk is not about ğŸš«

- Class components at all ğŸ˜¬
  - Why stale closures don't exist in class components? ğŸ¤ (if you want to deep
    dive, read [this][functional-vs-class-components])
- Under the hood implementation of hooks

### This talk is all about âœ…

- Pre-requisites ğŸš§
  - Scope ğŸ‘ & Closure ğŸ˜ˆ
  - useState ğŸ“¦ & useRef ğŸ¤ Hooks
- Understanding the Problem ğŸ§Ÿâ€
- Solutions ğŸ˜‹

---

# Pre-requisites ğŸš§

---

# Pre-requisites ğŸš§

Lets deep-dive into all of these pieces individually.

---

# Pre-requisites ğŸš§

Lets deep-dive into all of these pieces individually.

- Scope ğŸ‘

---

# Pre-requisites ğŸš§

Lets deep-dive into all of these pieces individually.

- Scope ğŸ‘
- Closure ğŸ˜ˆ

---

# Pre-requisites ğŸš§

Lets deep-dive into all of these pieces individually.

- Scope ğŸ‘
- Closure ğŸ˜ˆ
- useState Hook ğŸ“¦

---

# Pre-requisites ğŸš§

Lets deep-dive into all of these pieces individually.

- Scope ğŸ‘
- Closure ğŸ˜ˆ
- useState Hook ğŸ“¦
- useRef Hook ğŸ¤

---

# Scope ğŸ‘

---

# Scope ğŸ‘

Source codes ğŸ’°: [Example 1][scope-example-1]

---

# Scope ğŸ‘

Source codes ğŸ’°: [Example 1][scope-example-1] <br /> Resources ğŸ“‘: [Image
1][scope-image-1], [Image 2][scope-image-2]

---

# Scope ğŸ‘

Source codes ğŸ’°: [Example 1][scope-example-1] <br /> Resources ğŸ“‘: [Image
1][scope-image-1], [Image 2][scope-image-2]

### What does the term "scope" mean?

---

# Scope ğŸ‘

Source codes ğŸ’°: [Example 1][scope-example-1] <br /> Resources ğŸ“‘: [Image
1][scope-image-1], [Image 2][scope-image-2]

### What does the term "scope" mean?

- Scope is mechanism to look for things (things ğŸ¤¨).

---

# Scope ğŸ‘

Source codes ğŸ’°: [Example 1][scope-example-1] <br /> Resources ğŸ“‘: [Image
1][scope-image-1], [Image 2][scope-image-2]

### What does the term "scope" mean?

- Scope is mechanism to look for things (things ğŸ¤¨).
  - By things, I mean the identifiers.

---

# Scope ğŸ‘

Source codes ğŸ’°: [Example 1][scope-example-1] <br /> Resources ğŸ“‘: [Image
1][scope-image-1], [Image 2][scope-image-2]

### What does the term "scope" mean?

- Scope is mechanism to look for things (things ğŸ¤¨).
  - By things, I mean the identifiers.

### Where does it look for things?

---

# Scope ğŸ‘

Source codes ğŸ’°: [Example 1][scope-example-1] <br /> Resources ğŸ“‘: [Image
1][scope-image-1], [Image 2][scope-image-2]

### What does the term "scope" mean?

- Scope is mechanism to look for things (things ğŸ¤¨).
  - By things, I mean the identifiers.

### Where does it look for things?

- It looks for things in variable environments a.k.a V.Es (in simple words,
  temporary memory buckets).

---

# Scope ğŸ‘

Source codes ğŸ’°: [Example 1][scope-example-1] <br /> Resources ğŸ“‘: [Image
1][scope-image-1], [Image 2][scope-image-2]

### What does the term "scope" mean?

- Scope is mechanism to look for things (things ğŸ¤¨).
  - By things, I mean the identifiers.

### Where does it look for things?

- It looks for things in variable environments a.k.a V.Es (in simple words,
  temporary memory buckets).
- A bucket gets created when you create:

---

# Scope ğŸ‘

Source codes ğŸ’°: [Example 1][scope-example-1] <br /> Resources ğŸ“‘: [Image
1][scope-image-1], [Image 2][scope-image-2]

### What does the term "scope" mean?

- Scope is mechanism to look for things (things ğŸ¤¨).
  - By things, I mean the identifiers.

### Where does it look for things?

- It looks for things in variable environments a.k.a V.Es (in simple words,
  temporary memory buckets).
- A bucket gets created when you create:
  - functions

---

# Scope ğŸ‘

Source codes ğŸ’°: [Example 1][scope-example-1] <br /> Resources ğŸ“‘: [Image
1][scope-image-1], [Image 2][scope-image-2]

### What does the term "scope" mean?

- Scope is mechanism to look for things (things ğŸ¤¨).
  - By things, I mean the identifiers.

### Where does it look for things?

- It looks for things in variable environments a.k.a V.Es (in simple words,
  temporary memory buckets).
- A bucket gets created when you create:
  - functions
  - blocks

---

# Scope ğŸ‘

Source codes ğŸ’°: [Example 2][scope-example-2]

### okay, okay! What does the term "lexical scoping" mean then ğŸ¥º?

---

# Scope ğŸ‘

Source codes ğŸ’°: [Example 2][scope-example-2]

### okay, okay! What does the term "lexical scoping" mean then ğŸ¥º?

We know scope is just a mechanism to look for things, with that in mind:

---

# Scope ğŸ‘

Source codes ğŸ’°: [Example 2][scope-example-2]

### okay, okay! What does the term "lexical scoping" mean then ğŸ¥º?

We know scope is just a mechanism to look for things, with that in mind:

- lexical scoping is just an extended version of that mechanism to deal with
  nested V.Es

---

# Closure ğŸ˜ˆ

---

# Closure ğŸ˜ˆ

Source codes ğŸ’°: [Example][closure-example]

---

# Closure ğŸ˜ˆ

Source codes ğŸ’°: [Example][closure-example] <br /> Resources ğŸ“‘: [Image
1][closure-image-1], [Image 2][closure-image-2]

---

# Closure ğŸ˜ˆ

Source codes ğŸ’°: [Example][closure-example] <br /> Resources ğŸ“‘: [Image
1][closure-image-1], [Image 2][closure-image-2]

Okay so now, we understand lexical scoping. Lets deep-dive into closure.

---

# Closure ğŸ˜ˆ

Source codes ğŸ’°: [Example][closure-example] <br /> Resources ğŸ“‘: [Image
1][closure-image-1], [Image 2][closure-image-2]

Okay so now, we understand lexical scoping. Lets deep-dive into closure.

### What is closure ğŸ˜ˆ?

---

# Closure ğŸ˜ˆ

Source codes ğŸ’°: [Example][closure-example] <br /> Resources ğŸ“‘: [Image
1][closure-image-1], [Image 2][closure-image-2]

Okay so now, we understand lexical scoping. Lets deep-dive into closure.

### What is closure ğŸ˜ˆ?

- Closure is when a function somehow **remembers its outer V.E** during
  execution, even if it was called from a totally different place from where it
  was born ğŸ¤¯.

---

# Closure ğŸ˜ˆ

Source codes ğŸ’°: [Example][closure-example] <br /> Resources ğŸ“‘: [Image
1][closure-image-1], [Image 2][closure-image-2]

Okay so now, we understand lexical scoping. Lets deep-dive into closure.

### What is closure ğŸ˜ˆ?

- Closure is when a function somehow **remembers its outer V.E** during
  execution, even if it was called from a totally different place from where it
  was born ğŸ¤¯.
  - By remember I mean, it ~~captures~~ creates a live link.

---

# Closure ğŸ˜ˆ

Source codes ğŸ’°: [Example][closure-example] <br /> Resources ğŸ“‘: [Image
1][closure-image-1], [Image 2][closure-image-2]

Okay so now, we understand lexical scoping. Lets deep-dive into closure.

### What is closure ğŸ˜ˆ?

- Closure is when a function somehow **remembers its outer V.E** during
  execution, even if it was called from a totally different place from where it
  was born ğŸ¤¯.
  - By remember I mean, it ~~captures~~ creates a live link.
- In simple words, it creates an additional bucket.

---

# useState Hook ğŸ“¦

---

# useState Hook ğŸ“¦

Source codes ğŸ’°: [Example][use-state-hook]

---

# useState Hook ğŸ“¦

Source codes ğŸ’°: [Example][use-state-hook]

### How do you define useState hook?

---

# useState Hook ğŸ“¦

Source codes ğŸ’°: [Example][use-state-hook]

### How do you define useState hook?

~~useState hook lets you add state to your functional components~~

---

# useState Hook ğŸ“¦

Source codes ğŸ’°: [Example][use-state-hook]

### How do you define useState hook?

~~useState hook lets you add state to your functional components~~

- useState is an API that does the following in functional components:

---

# useState Hook ğŸ“¦

Source codes ğŸ’°: [Example][use-state-hook]

### How do you define useState hook?

~~useState hook lets you add state to your functional components~~

- useState is an API that does the following in functional components:
  - preserves a value across renders

---

# useState Hook ğŸ“¦

Source codes ğŸ’°: [Example][use-state-hook]

### How do you define useState hook?

~~useState hook lets you add state to your functional components~~

- useState is an API that does the following in functional components:
  - preserves a value across renders
  - triggers re-render

---

# useRef Hook ğŸ¤

---

# useRef Hook ğŸ¤

Source codes ğŸ’°: [Example][use-ref-hook]

---

# useRef Hook ğŸ¤

Source codes ğŸ’°: [Example][use-ref-hook]

### How do you define useRef hook?

---

# useRef Hook ğŸ¤

Source codes ğŸ’°: [Example][use-ref-hook]

### How do you define useRef hook?

- useRef hook is an API somewhat similar to useState that does the followings:

---

# useRef Hook ğŸ¤

Source codes ğŸ’°: [Example][use-ref-hook]

### How do you define useRef hook?

- useRef hook is an API somewhat similar to useState that does the followings:
  - It returns a single mutable preserved object across renders

---

# useRef Hook ğŸ¤

Source codes ğŸ’°: [Example][use-ref-hook]

### How do you define useRef hook?

- useRef hook is an API somewhat similar to useState that does the followings:
  - It returns a single mutable preserved object across renders
  - unlike useState, it doesn't trigger re-render

----

# Understand the Problem ğŸ§Ÿâ€

---

# Understand the Problem ğŸ§Ÿâ€

Source codes ğŸ’°: [Problem 1][stale-closures-1], [Problem 2][stale-closures-2]

---

# Understand the Problem ğŸ§Ÿâ€

Source codes ğŸ’°: [Problem 1][stale-closures-1], [Problem 2][stale-closures-2]

### What does the term "stale closure" mean?

---

# Understand the Problem ğŸ§Ÿâ€

Source codes ğŸ’°: [Problem 1][stale-closures-1], [Problem 2][stale-closures-2]

### What does the term "stale closure" mean?

- Stale means **outdated**.

---

# Understand the Problem ğŸ§Ÿâ€

Source codes ğŸ’°: [Problem 1][stale-closures-1], [Problem 2][stale-closures-2]

### What does the term "stale closure" mean?

- Stale means **outdated**.
- So, stale closure is when a closure gets outdated ğŸ¤§.

---

# Solutions ğŸ˜‹

---

# Solutions ğŸ˜‹

Source codes ğŸ’°: [Solution 1][stale-closures-solution-1], [Solution
2][stale-closures-solution-2]

---

# Solutions ğŸ˜‹

Source codes ğŸ’°: [Solution 1][stale-closures-solution-1], [Solution
2][stale-closures-solution-2]

<img src="http://localhost:8081/playing-computer.gif" style={{height: 500}} />

---

# Recap ğŸ¤ 

---

# Recap ğŸ¤ 

### What's the right tool when you need a persistent value across renders, which is a part of your UI?

---

# Recap ğŸ¤ 

### What's the right tool when you need a persistent value across renders, which is a part of your UI?

<img src="http://localhost:8081/use-state.png" style={{height: 500}} />

---

# Recap ğŸ¤ 

### What's the right tool when you need a persistent value across renders, which isn't a part of your UI?

---

# Recap ğŸ¤ 

### What's the right tool when you need a persistent value across renders, which isn't a part of your UI?

<img src="http://localhost:8081/use-ref.png" style={{height: 500}} />

---

# Takeaways ğŸ’¸

---

# Takeaways ğŸ’¸

- Ask _why_ not only when it didn't work but also when it worked

---

# Takeaways ğŸ’¸

- Ask _why_ not only when it didn't work but also when it worked.
- Treat others well, regardless of age & expertise

---

# Takeaways ğŸ’¸

- Ask _why_ not only when it didn't work but also when it worked.
- Treat others well, regardless of age & expertise

### For juniors

---

# Takeaways ğŸ’¸

- Ask _why_ not only when it didn't work but also when it worked.
- Treat others well, regardless of age & expertise

### For juniors

- When reaching out to a Sr. for help:

---

# Takeaways ğŸ’¸

- Ask _why_ not only when it didn't work but also when it worked.
- Treat others well, regardless of age & expertise

### For juniors

- When reaching out to a Sr. for help:
  - Tell them the end product you're looking for

---

# Takeaways ğŸ’¸

- Ask _why_ not only when it didn't work but also when it worked.
- Treat others well, regardless of age & expertise

### For juniors

- When reaching out to a Sr. for help:
  - Tell them the end product you're looking for
  - Also tell them about X, Y, & Z solutions you've tried so far.

---

# Takeaways ğŸ’¸

- Ask _why_ not only when it didn't work but also when it worked.
- Treat others well, regardless of age & expertise

### For juniors

- When reaching out to a Sr. for help:
  - Tell them the end product you're looking for.
  - Also tell them about X, Y, & Z solutions you've tried so far.

### Thank you all ğŸ™‚

[comment]: # 'Stale closures in action'
[stale-closures-1]: https://codesandbox.io/s/stale-closures-1-xut3g
[stale-closures-2]: https://codesandbox.io/s/stale-closures-2-culy8
[comment]: # 'Stale closures solution'
[stale-closures-solution-1]:
  https://codesandbox.io/s/stale-closures-solution-1-1dpeo
[stale-closures-solution-2]:
  https://codesandbox.io/s/stale-closures-solution-2-plsrb
[comment]: # 'Personal Info'
[github]: https://www.github.com/iamfotx
[twitter]: https://www.twitter.com/iamfotx
[linked-in]: https://www.linkedin.com/in/iamfotx
[facebook]: https://www.facebook.com/iamfotx
[email-me]: mailto://iamfotx@gmail.com
[black-sms]: https://www.linkedin.com/company/black-sms
[comment]: # 'Scope'
[scope-example-1]:
  https://codesandbox.io/s/scope-examples-fmw9z?file=/src/example-0.js
[scope-example-2]:
  https://codesandbox.io/s/scope-examples-fmw9z?file=/src/example-1.js
[scope-image-1]:
  https://drive.google.com/file/d/1ywe52nw11RwqKwL4I5OdpyjACeEgEIeK/view?usp=sharing
[scope-image-2]:
  https://drive.google.com/file/d/1oJcY_GFfeA6BKojLoll-weQyV2WE-Urv/view?usp=sharing
[closure-image-1]:
  https://drive.google.com/file/d/11NMYtMuaBuzDUAUWEY-GFvITWfPeAPUY/view?usp=sharing
[closure-image-2]:
  https://drive.google.com/file/d/10EyiCLTq-q1YjDW_esOL_ulDnFixgzBC/view?usp=sharing
[comment]: # 'Closure'
[closure-example]:
  https://codesandbox.io/s/closure-examples-jfn6h?file=/src/example-0.js
[comment]: # 'useState hook'
[use-state-hook]: https://codesandbox.io/s/use-state-hook-x31gu?file=/src/App.js
[comment]: # 'useRef hook'
[use-ref-hook]: https://codesandbox.io/s/use-ref-hook-bjgn5?file=/src/App.js
[comment]: # 'Others'
[functional-vs-class-components]:
  https://overreacted.io/how-are-function-components-different-from-classes/
